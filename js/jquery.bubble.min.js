$(function(){function ImPluginClass(wrap,cfg){var config=$.extend(!0,{},cfg||{});this.wrap=wrap,this.get=function(n){return config[n]},this.set=function(n,v){config[n]=v},this.init()}var _DEFAULT={itemClass:"J_BubbleItem",size:[60,120],blowTime:[.5,1],direction:"right",offset:[0,60],interval:1.2},DIRFLAG={left:!0,right:!0};ImPluginClass.prototype.init=function(){this.formatWrap(),this.blow()},ImPluginClass.prototype.formatWrap=function(){var pos=this.wrap.css("position");pos&&"static"!==pos||this.wrap.css("position","relative")},ImPluginClass.prototype.blow=function(){var that=this,wrap=that.wrap,timer=that.get("timer");timer&&clearInterval(timer),timer=setInterval(function(){var item=$('<div class="'+that.get("itemClass")+' bubbles">'),size=that.get("size"),dir=that.get("direction"),offset=that.get("offset"),width=(size[1]-size[0])*Math.random()+size[0],bTime=that.get("blowTime"),blowTime=(bTime[1]-bTime[0])*Math.random()+bTime[0],toTop=offset[1]-width/2,style={position:"absolute",width:0,height:0};DIRFLAG[dir]||(dir="left"),style[dir]=offset[0],style.top=offset[1],item.css(style),wrap.append(item),item.animate({top:toTop,width:width,height:width},1e3*blowTime,function(){setTimeout(function(){that.fall.call(that,item)},150)})},1e3*that.get("interval")),that.set("timer",timer)},ImPluginClass.prototype.fall=function(item){var startx,starty,endPoint,interval,that=this,dir=that.get("direction"),wrapWdith=that.wrap.width(),wrapHeight=that.wrap.height(),itemWidth=item.outerWidth(),itemHeight=item.outerHeight(),speedx=Math.random()*wrapWdith*.1+10,speedy=0,decay=.4*Math.random()+.6;speedx="right"===dir?speedx*-1:speedx,interval=setInterval(function(){var nT,nL;startx=parseFloat(item.css("left")),starty=parseFloat(item.css("top")),speedy+=3,nT=starty+speedy,nL=startx+speedx,nT<0?(nT=0,speedy*=-1*decay,speedy<0?Math.ceil(speedy):Math.floor(speedy),speedx*=decay,speedx<0?Math.ceil(speedx):Math.floor(speedx)):nT>wrapHeight-itemHeight&&(nT=wrapHeight-itemHeight,speedy*=-1*decay,speedy<0?Math.ceil(speedy):Math.floor(speedy),speedx*=decay,speedx<0?Math.ceil(speedx):Math.floor(speedx)),nL<0?(nL=0,speedx*=-1*decay,speedx<0?Math.ceil(speedx):Math.floor(speedx)):nL>wrapWdith-itemWidth&&(nL=wrapWdith-itemWidth,speedx*=-1*decay,speedx<0?Math.ceil(speedx):Math.floor(speedx)),item.css({left:nL,top:nT}),nT===endPoint&&(clearInterval(interval),setTimeout(function(){that.remove.call(that,item)},300)),endPoint=nT},25)},ImPluginClass.prototype.remove=function(item){item.fadeOut(function(){item.remove()})},$.fn.bubble=function(cfg){var config=$.extend({},_DEFAULT,cfg||{});if(!this.length)throw"Elements not found.";return this.each(function(idx,ele){var $this=$(ele);$this.parents("body").length||($this=$("body")),$this.data("bubble",new ImPluginClass($this,config))})}});